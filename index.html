<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Speak & Repeat – January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{
  --bg:#0b1530; --ink:#fff; --outline:#ffffff26; --radius:26px;
  --pink:#ff7eb9; --mint:#a6f7b2; --blue:#7dd3fc; --yell:#fff680; --vio:#c77dff; --green:#22c55e;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--ink);
  font-family:system-ui,"Noto Sans JP",sans-serif;-webkit-overflow-scrolling:touch;
}

/* Header / Footer */
header{text-align:center;padding:26px 12px 12px}
.h1{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(34px,6.2vw,56px);letter-spacing:.5px;text-transform:uppercase;}
.h2{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(22px,4.5vw,36px);margin-top:6px;}
.h3{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(16px,3.6vw,22px);margin-top:10px;opacity:.9;}
.h4{font-weight:800;font-size:clamp(14px,3.4vw,20px);color:#cfe1ff;margin-top:2px;}
footer{text-align:center;color:#c9d4ec;font-family:'Cinzel',serif;font-weight:700;padding:40px 10px}

/* Shell */
.wrap{max-width:1100px;margin:0 auto;padding:8px 16px 86px}
.panel{padding:20px;border:1px solid var(--outline);border-radius:var(--radius);
  background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
  box-shadow:0 6px 24px rgba(0,0,0,.4);}

/* Sentence card */
.card{position:relative;border:1px solid var(--outline);border-radius:var(--radius);padding:22px 16px;margin-bottom:10px;
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
  overflow:hidden;
}
.en{
  position:relative;
  font-weight:900;font-size:clamp(26px,7.4vw,48px);line-height:1.22;text-align:center;letter-spacing:.2px;
  z-index:2;
}
.en .word{
  display:inline-block;
  padding:0 .06em;
  color:#ffffff;
  transition:color .25s ease;
}
.en .word.black{color:#000}

/* glowing sweep */
.sweep{
  position:absolute;
  top:0;left:-20%;
  width:40%;height:100%;
  background:radial-gradient(circle at 30% 50%, rgba(255,246,128,.9) 0%, rgba(255,246,128,.6) 40%, rgba(255,246,128,0) 80%);
  filter:blur(20px);
  border-radius:40px;
  z-index:1;
  opacity:0;
}

/* Support bar */
.supportBar{
  margin:8px 0 14px; border:1px solid var(--outline); border-radius:14px; padding:12px 14px;
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
}
.jp{font-weight:700;font-size:clamp(16px,3.8vw,22px);text-align:center;color:#d8e7ff}
.hira{font-size:clamp(14px,3.4vw,18px);text-align:center;color:#bcd3ff;margin-top:6px}

/* Meter */
.meterWrap{display:flex;align-items:center;justify-content:center;margin:22px 0}
.meter{position:relative;width:min(64vw,290px);height:min(64vw,290px);display:grid;place-items:center}
.ring{
  position:absolute;inset:0;border-radius:50%;
  background:conic-gradient(#22c55e,#facc15,#f43f5e,#a78bfa,#60a5fa,#22c55e);
  -webkit-mask:radial-gradient(circle, transparent 60%, black 62%);
  mask:radial-gradient(circle, transparent 60%, black 62%);
  filter:drop-shadow(0 0 16px rgba(255,255,255,.25));
  animation:rainbowCycle 3s linear infinite;
  transition:transform .1s ease;
}
@keyframes rainbowCycle{
  0%{filter:hue-rotate(0deg) drop-shadow(0 0 16px rgba(255,255,255,.25))}
  100%{filter:hue-rotate(360deg) drop-shadow(0 0 16px rgba(255,255,255,.25))}
}
.meterCore{
  position:absolute;inset:12% 12%;border-radius:50%;
  background:radial-gradient(circle at 50% 40%, rgba(255,255,255,.14), rgba(255,255,255,.04));
  display:grid;place-items:center; text-align:center;
}
.meterText{ font-weight:900;font-size:clamp(18px,6vw,28px); text-shadow:0 2px 0 rgba(0,0,0,.35) }

/* Buttons */
.btnRow{display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{display:inline-grid;place-items:center;gap:4px;min-width:160px;
  border:none;border-radius:999px;padding:14px 20px;
  font-weight:900;font-size:clamp(18px,4vw,22px);
  color:#001e08;text-shadow:0 1px 0 rgba(255,255,255,.6);
  cursor:pointer;transition:transform .05s ease}
.btn:active{transform:scale(.97)}
.btn.begin{background:radial-gradient(circle at 30% 30%, #1ee99a, #15c473, #0ea85d);}
.btn.retry{background:radial-gradient(circle at 30% 30%, #8ec5ff, #4da0ff, #1e6eff);}
.btn.next{background:radial-gradient(circle at 30% 30%, #ff9ad7, #ff6ec7, #ff4fa6);}
.btn:disabled{opacity:.5;cursor:not-allowed}

/* Progress / Score */
#progress{text-align:center;color:#cfe1ff;opacity:.9;font-weight:700;margin-top:8px}
.scoreBox{
  margin:14px auto 6px;max-width:620px;text-align:center;padding:14px 16px;border-radius:18px;border:1px solid var(--outline);
  background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
  font-weight:900;font-size:clamp(18px,4.2vw,24px);
}
.scoreBox.good{box-shadow:0 0 28px rgba(34,197,94,.5) inset, 0 0 18px rgba(34,197,94,.35)}
.scoreBox.mid{box-shadow:0 0 28px rgba(96,165,250,.5) inset, 0 0 18px rgba(96,165,250,.35)}
.scoreBox.bad{box-shadow:0 0 28px rgba(229,57,53,.5) inset, 0 0 18px rgba(229,57,53,.35)}

/* FX */
.fx{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:1000}
.puff{position:absolute;border-radius:50%;filter:blur(.5px);animation:puffUp 1500ms ease-out forwards}
@keyframes puffUp{0%{opacity:0;transform:translate(-50%,-10px) scale(.6)}20%{opacity:.95}100%{opacity:0;transform:translate(-50%,-260px) scale(1.45)}}
.confetti{position:absolute;width:12px;height:12px;top:-20px;animation:confettiFall 3.5s linear forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0)}100%{transform:translateY(110vh) rotate(720deg);opacity:0}}
</style>
</head>
<body>
<header>
  <div class="h1">THE BOO-RICULUM</div>
  <div class="h2">SPEAK &amp; REPEAT</div>
  <div class="h3">January Week 1 – Speaking Practice</div>
  <div class="h4">１月第１週 – スピーキング練習</div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="card">
      <div class="sweep" id="sweep"></div>
      <div id="en" class="en">Press はじめる to start</div>
    </div>
    <div class="supportBar">
      <div id="jp" class="jp"></div>
      <div id="hira" class="hira"></div>
    </div>
    <div class="meterWrap">
      <div class="meter">
        <div id="ring" class="ring"></div>
        <div class="meterCore"><div id="meterText" class="meterText">リスニング中</div></div>
      </div>
    </div>
    <div class="btnRow">
      <button id="beginBtn" class="btn begin">はじめる<br><small>Begin</small></button>
      <button id="retryBtn" class="btn retry" style="display:none">もう一回<br><small>Retry</small></button>
      <button id="nextBtn" class="btn next" style="display:none">つぎへ<br><small>Next</small></button>
    </div>
    <div id="progress">０ / １５（０％）</div>
    <div id="scoreBox" class="scoreBox" style="display:none">スコア：—％</div>
  </div>
</div>
<div id="fx" class="fx"></div>
<footer>Bryan’s English School</footer>

<script>
const ITEMS=[{en:"What is your goal this year?",jp:"今年の目標は何ですか。",hira:"(ことし の もくひょう は なん です か)"},/* ...same 15 items ...*/];

const enEl=document.getElementById('en'),jpEl=document.getElementById('jp'),hiraEl=document.getElementById('hira');
const beginBtn=document.getElementById('beginBtn'),retryBtn=document.getElementById('retryBtn'),nextBtn=document.getElementById('nextBtn');
const progress=document.getElementById('progress'),scoreBox=document.getElementById('scoreBox');
const ring=document.getElementById('ring'),meterText=document.getElementById('meterText'),sweep=document.getElementById('sweep');
let idx=0,unlocked=false,wordsMeta=null,sweepRAF=null,audioCtx=null,mediaStream=null,analyser=null,dataArray=null,rafId=null;

function mountWords(t){
  const parts=t.split(/\s+/).filter(Boolean);
  enEl.innerHTML=parts.map(w=>`<span class="word">${w}</span>`).join(' ');
  wordsMeta=[...enEl.querySelectorAll('.word')];
}
function toFW(n){return n.toString().replace(/\d/g,d=>"０１２３４５６７８９"[d]);}
function updateProgress(){progress.textContent=`${toFW(idx+1)} / ${toFW(ITEMS.length)}（${toFW(Math.round(idx/ITEMS.length*100))}％）`;}
function showItem(){
  const it=ITEMS[idx];
  mountWords(it.en);jpEl.textContent=it.jp;hiraEl.textContent=it.hira;
  scoreBox.style.display='none';meterText.textContent='リスニング中';updateProgress();
}

/* glowing sweep logic */
function startSweep(duration=3000){
  sweep.style.opacity=1;
  const rect=enEl.getBoundingClientRect();
  const total=rect.width;
  const start=performance.now();
  cancelAnimationFrame(sweepRAF);
  function step(t){
    const p=Math.min((t-start)/duration,1);
    const x=total*p;
    sweep.style.left=(x-total*0.2)+"px";
    for(const w of wordsMeta){
      const r=w.getBoundingClientRect();
      const center=r.left+r.width/2-rect.left;
      w.classList.toggle('black',center<=x);
    }
    if(p<1) sweepRAF=requestAnimationFrame(step);else sweep.style.opacity=0;
  }
  sweepRAF=requestAnimationFrame(step);
}

/* microphone ring */
async function startRing(){
  try{mediaStream=await navigator.mediaDevices.getUserMedia({audio:true});}
  catch(e){return;}
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const src=audioCtx.createMediaStreamSource(mediaStream);
  analyser=audioCtx.createAnalyser();analyser.fftSize=2048;
  dataArray=new Uint8Array(analyser.fftSize);src.connect(analyser);
  let smooth=0;
  function tick(){
    analyser.getByteTimeDomainData(dataArray);
    let sum=0;for(let i=0;i<dataArray.length;i++){const v=(dataArray[i]-128)/128;sum+=v*v;}
    const rms=Math.sqrt(sum/dataArray.length);
    const level=Math.min(rms*3,1);
    smooth=smooth*0.8+level*0.2;
    ring.style.transform=`scale(${1+smooth*0.35})`;
    rafId=requestAnimationFrame(tick);
  }
  tick();
}
function stopRing(){
  cancelAnimationFrame(rafId);
  if(mediaStream){mediaStream.getTracks().forEach(t=>t.stop());mediaStream=null;}
  if(audioCtx){audioCtx.close();audioCtx=null;}
  ring.style.transform='scale(1)';
}

/* simple flow placeholder (demo) */
function nextItem(){
  idx++;
  if(idx>=ITEMS.length){enEl.textContent="Great work today!";jpEl.textContent="よくがんばりました！";hiraEl.textContent="";scoreBox.style.display='block';scoreBox.textContent="ぜんぶできました！おつかれさま！";return;}
  showItem();
}

/* Begin */
beginBtn.addEventListener('click',async()=>{
  if(!unlocked){audioCtx=new (window.AudioContext||window.webkitAudioContext)();await audioCtx.resume();unlocked=true;}
  showItem();
  await startRing();
  startSweep(3000);
  setTimeout(()=>{stopRing();},3000);
});

/* Retry/Next demo */
retryBtn.addEventListener('click',()=>startSweep(3000));
nextBtn.addEventListener('click',()=>nextItem());
showItem();
</script>
</body>
</html>
